---
name: "fgm-code-reviewer"
description: "审查本项目代码：逻辑正确性、架构分层、数据结构、UI/UX 布局与可维护性。用户要“审查/评审/巡检/找问题/给改进建议”时调用。"
---

# FGM 项目代码审查

本技能用于对仓库进行“工程化审查”：发现逻辑缺陷、架构耦合与坏味道、数据模型问题、UI/UX 布局风险，并给出按优先级排序的改进建议与可落地的重构方案。

## 何时调用

- 用户要求审查当前项目代码质量（逻辑/架构/数据结构/UI/UX）
- 准备发布或大改前做一次风险巡检
- 出现持续性回归、修改困难、文件越来越大、UI 越来越难维护等信号

## 审查范围与原则（必须遵守）

- 模块化：UI 拆分为独立 Panels，Window 只做组装与路由
- 低耦合：UI 表现层、业务逻辑层、数据层、IO 层分离
- 可维护性：避免上帝类与静态 UI 状态泛滥，控制单文件复杂度
- Def 改动：涉及 Def 的修改必须用 PatchOperation
- 语言适配：所有 UI 文本必须支持多语言（中英一致），布局避免因文本长度溢出
- RimWorld 1.6：Patch 与原版机制交互需谨慎，必要时先用 rim-search 确认调用链

## 审查维度与检查点

### 1) 逻辑正确性

- 空值与边界：未初始化、列表为空、越界、缺省值不一致
- 状态一致性：UI 状态与数据源同步、撤销/重做对数据的影响、保存/加载一致
- 幂等性：多次点击/重复应用是否产生重复数据或不可逆副作用
- 错误处理：是否吞掉异常、是否在关键路径缺少保护导致刷红字

### 2) 架构与依赖

- 职责边界：UI/Managers/Data/IO/Patches 各自是否越界
- 依赖方向：UI 不应直接写 IO；Patch 不应承载业务规则
- 可扩展点：新增能力是否可通过扩展点实现，而非大面积改动既有逻辑
- 重构风险：是否存在“牵一发动全身”的高耦合对象/静态单例

### 3) 数据结构与持久化

- 模型清晰度：数据类是否仅表达业务概念，避免夹带 UI/缓存状态
- 序列化稳定性：字段变更是否需要迁移策略，默认值是否与旧预设兼容
- 性能与规模：集合选择是否合理，是否存在频繁全量遍历 Def/Thing 的热点
- 校验规则：输入校验是否集中、规则是否可复用、错误提示是否可理解

### 4) UI/UX 与布局

- 布局稳定：缩放/分辨率/滚动区域/裁剪是否正确
- 信息架构：关键操作是否可发现，危险操作是否有确认与可撤销
- 交互一致：按钮、列表、筛选、搜索等交互是否一致
- 多语言布局：文本长度变化下是否溢出/重叠/遮挡

## 输出格式（建议直接按此输出）

1) 总结
- 总体评价：健康 / 可改进 / 风险较高
- 最大风险：一句话说明最影响稳定性或维护性的点

2) 发现列表（按优先级）
- P0 阻断：会崩溃/刷红字/数据损坏/严重性能问题
- P1 重要：逻辑隐患/耦合过高/难维护/易回归
- P2 优化：可读性、命名、重复代码、体验改进

3) 建议与落地
- 最小改动修复：对应 P0/P1 的可快速落地方案
- 结构性重构：按模块拆分与替换顺序给出方案
- 回归清单：3-8 条用户路径与边界条件

## 建议的审查方法（执行步骤）

- 先读 README_ARCH 与核心入口（Core/Startup/UI 主窗口），建立模块边界认知
- 再扫 Managers 与 Data 的数据流，画出“入口→规则→落盘/应用”的最短链路
- 最后看 UI Panels 的组合方式与状态归属，识别静态状态与上帝类风险
- 若涉及原版机制或 Patch 争议点：先用 rim-search 做“原版调用链核对”

