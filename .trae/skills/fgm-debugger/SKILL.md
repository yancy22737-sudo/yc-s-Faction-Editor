---
name: "fgm-debugger"
description: "做 RimWorld 1.6 模组调试与问题定位：复现、日志抓取、Patch 排查、最小修复方案。出现报错/卡顿/行为异常/无法复现时调用。"
---

# FGM 调试与问题定位

本技能用于把“看起来不对劲”的问题，快速转化为：稳定复现步骤、最可疑的代码区、可验证的修复与回归清单。

## 何时调用

- 游戏报错（红字）、无限报错刷屏、卡死/帧数暴降
- 行为异常（装备没应用/应用错对象/保存后丢失/生成不生效）
- Harmony Patch 冲突、顺序问题、前后缀逻辑不符合预期
- UI 绘制错位、点击无响应、语言切换后显示异常
- 用户说“我这边复现不了/偶发/只在某些存档出现”

## 必须先收集的信息（不齐也能开始，但要标注缺口）

- 现象：具体看到什么（截图/红字堆栈/日志片段）
- 频率：必现/偶发/与存档相关/与派系或兵种相关
- 环境：RimWorld 版本、DLC、模组列表（至少冲突嫌疑的几项）
- 触发路径：从主菜单到触发点的操作序列
- 预期行为：正确情况下应该发生什么

## 定位流程（按顺序执行）

1) 复现与最小化
- 写出 3-8 步复现步骤
- 尝试“二分法”最小化：减少模组、减少派系/兵种配置、换新档验证
- 标注影响因子：是否与语言、分辨率、缩放、时间点（生成/战斗/保存加载）有关

2) 日志与堆栈阅读
- 找到第一条异常的根因堆栈（不是连带错误）
- 区分：Null/Index/InvalidOperation/Xml/Patch 异常、以及性能警告
- 记录关键信息：方法名、类名、触发方（UI/生成/IO）

3) 代码切入点归因
- UI 问题：优先看 Window/Panel 的输入事件、布局 Rect、状态来源
- 数据问题：优先看 Data 模型变化、序列化/反序列化、默认值与迁移
- 生成/应用问题：优先看 Managers 的调用链与 GearApplier 的决策点
- Patch 问题：确认 Patch 目标方法、前后缀返回值语义、优先级与短路条件

4) 修复策略选择
- 优先最小修复：只改一个明确的决策点，避免联动改动
- 必要时加保护：空值/越界/未初始化（同时确保不会吞掉真正错误）
- 若根因是架构耦合：提出拆分方案，但先做“止血补丁”保证可用

5) 验证与回归
- 复现用例必须变成回归用例（同一路径不再触发）
- 补充 2-5 个相邻路径（例如：不同语言、不同兵种、保存/加载、撤销/重做）

## 输出格式（建议直接按此输出）

1) 问题摘要
- 现象：
- 复现步骤：
- 期望：

2) 初步判断
- 最可疑模块：
- 可能根因（1-3 条，按概率排序）：

3) 证据
- 日志/堆栈关键行：
- 为什么指向这些位置：

4) 修复方案
- 最小修复：
- 备选修复：
- 风险与回归点：

## RimWorld 1.6 调试注意点

- Patch 行为变化优先检查 Harmony 版本与补丁签名匹配
- UI 问题优先确认 Unity GUI 的分组/裁剪与坐标系（尤其是窗口标题栏/留白相关）
- 性能问题优先排查高频 Tick、UI 重绘热路径、以及反射/遍历 Def 的位置

